window.onload=function(){menu("pai-test-box");menu("pai-menu-list");menu("pai-bpmn-left");tab("dms-prop-tab","dms-chart-box");tab("selected-tab","right_wrap");tab("selected-tab","wrap-right-wrap");tab("dms-field-tab","dms-field-box");tab("dms-PerformTuning-tab","dms-PerformTuning-box");tab("dms-argumentTune-tab","dms-argumentTune-box");tab("dms-setTuning-tab","dms-setTuning-box");navTab("btn-home-page");navTab("btn-module");navTab("btn-data-origin");navTab("btn-experiment");designation();checkAll("createPortGroup-box");var d=["周一","周二","周三","周四","周五","周六","周日"];var c=[5,8,10,18,4,6,10];reportChart(d,c);radio("targetListBox");fieldSet("field-set-box");toggleTest("ui-context-menu-layer")};function menu(b){var c=$("."+b);switch(b){case"pai-test-box":$(c).on("click",function(){$(this).nextAll(".pai-menu-list").is(":hidden")?$(this).nextAll(".pai-menu-list").show():$(this).nextAll(".pai-menu-list").hide();$(this).nextAll(".pai-menu-list").is(":hidden")?$(this).find("i").addClass("active"):$(this).find("i").removeClass("active")});break;case"pai-bpmn-left":var d=$(c).find(".box");d.on("click",function(){$(this).nextAll("ul").is(":hidden")?$(this).nextAll("ul").show():$(this).nextAll("ul").hide();$(this).nextAll("ul").is(":hidden")?$(this).removeClass("is-opened"):$(this).addClass("is-opened")});break;default:break}}function checkAll(l){var d=$("."+l+" .right_wrap .table-body tr");var k=$("."+l+" .left_wrap .ui-checkbox input.checkBox");var m=$("."+l+" .right_wrap tbody");d.hide();var h=function(){for(var a=1,o=0;a<k.length;a++){k[a].checked&&o++}k[0].checked=o==k.length-1};k[0].onclick=function(){for(var a=1;a<k.length;a++){k[a].checked=this.checked}arr("createPortGroup-box");h()};for(var f=1;f<k.length;f++){k[f].onclick=function(){h()}}var g=[];var c=[];var b=$(".zero-accordion").find(".zero-accordion-item").find("span.checkBox");var e=$(".zero-accordion").find(".zero-accordion-item").find("span.data-val i");var j=$("."+l+" .left_wrap .zero-accordion-item input.checkBox");b.each(function(){g.push($(this).text())});e.each(function(){c.push($(this).text())});for(var f=0;f<g.length;f++){$(k[f+1]).addClass(g[f]+"_"+c[f])}j.on("click",function(){var o=$(this).siblings("span.checkBox").text();var p=$(this).parents(".zero-accordion-item").find(".data-val i").text();var a=$("."+l+" .right_wrap tbody");var n=o+"_"+p;var i="";i+='<tr class="'+n+'"><td><span class="icon icon-delete btn-delete" onclick="del(this)"></span></td><td class="abc">'+o+"</td><td>"+p+"</td></tr>";if($(this).is(":checked")){a.append(i);$(this).addClass(n)}else{a.find("."+n).remove()}});$("."+l+" .right_wrap .table-header .icon-delete").on("click",function(){$(this).parents(".table-header").next(".table-body").find("tbody tr").remove();for(var a=0;a<k.length;a++){k[a].checked=false}});$("."+l+" .right_wrap .table-body .icon-delete").on("click",function(){var a=$(this).parents("tr").attr("class");$(".left_wrap .zero-accordion-item").find("."+a).prop("checked",false);h()})}function arr(j){var g=[];var c=[];var b=$("."+j+" .left_wrap  .zero-accordion-item span.checkBox");var d=$("."+j+" .left_wrap  .zero-accordion-item .data-val i");var h=$("."+j+" .left_wrap .ui-checkbox input.checkBox");var k=$("."+j+" .right_wrap tbody");var f="";b.each(function(){g.push($(this).text())});d.each(function(){c.push($(this).text())});k.find("tr").remove();if(h[0].checked){for(var e=0;e<g.length;e++){f+='<tr class="'+g[e]+"_"+c[e]+'"><td><span class="icon icon-delete btn-delete" onclick="del(this)"></span></td><td>'+g[e]+"</td><td>"+c[e]+"</td></tr>"}k.append(f)}else{k.find("tr").remove()}}function del(b){var d=$(b);var c=d.parents("tr").attr("class");d.parents("tr").remove();$(".left_wrap .zero-accordion-item").find("."+c).prop("checked",false);return}function tab(e,c){var d=$("."+e+" li");var f=$("."+c+" .dms-prop-page");d.on("click",function(){var a=$(this).index();$(this).hasClass("selected")?$(this).attr("class","selected"):$(this).addClass("selected").siblings("li").removeClass("selected");f.eq(a).show().siblings(".dms-prop-page").hide()})}function workArea(a){var f=$("#container .model"),e=$("."+a)[0].style;var d=$(".removeElement");var c=$(".btn-execute-begin");e.display="none";f.on("contextmenu",function(b){var b=b||window.event;var g=$(this);var h=[document.documentElement.offsetWidth,document.documentElement.offsetHeight];e.display="block";e.top=b.clientY+"px";e.left=b.clientX+"px";maxWidth=h[0]-$("."+a+" ul")[0].offsetWidth;maxHeight=h[1]-$("."+a+" ul")[0].offsetHeight;$("."+a)[0].offsetTop>maxHeight&&(e.top=maxHeight+"px");$("."+a)[0].offsetLeft>maxWidth&&(e.left=maxWidth+"px");d.unbind("click").on("click",function(){var i=$(g);if(confirm("确定删除该模型？")){save();jsPlumb.remove(i)}e.display="none"});$(".btn-view-data").unbind("click").click(function(){$(".view-data-box").modal("show");$(".view-data-box").css({display:"table",height:"100%",width:"1100px",left:"50%","margin-left":"-550px"});$(".view-data-box .modal-w").width("1100px")});c.unbind("click").on("click",function(){g.find(".status").attr("class","status icon-loading");e.display="none"});return false});$("."+a+" .ui-context-menu-item").on("click",function(){e.display="none"});$("body").on("click",function(){e.display="none"})}function navTab(b){switch(b){case"btn-home-page":$("."+b).on("click",function(a){a.stopPropagation();$(".pai-home").animate({bottom:0},0)});break;case"btn-module":$("."+b).on("click",function(a){a.stopPropagation();$(".pai-home").animate({bottom:"100%"},0);$("#leftMenu .pai-toolbox-sec").hide();$("#leftMenu .pai-toolbox-sec").eq(0).show()});break;case"btn-data-origin":$("."+b).on("click",function(a){a.stopPropagation();$(".pai-home").animate({bottom:"100%"},0);$("#leftMenu .pai-toolbox-sec").hide();$("#leftMenu .pai-toolbox-sec").eq(1).show()});break;case"btn-experiment":$("."+b).on("click",function(a){a.stopPropagation();$(".pai-home").animate({bottom:"100%"},0);$("#leftMenu .pai-toolbox-sec").hide();$("#leftMenu .pai-toolbox-sec").eq(2).show()});break}}function designation(){var b=$(".pai-bpmn-left .text");var c=$(".pai-bpmn-left .pai-dropdown li");var a=$(".pai-bpmn-left  .pai-dropdown li .btn-close");c.on("click",function(){if($(this).hasClass("selected")){return}else{$(this).addClass("selected").siblings("li").removeClass("selected")}var d=$(this).find(".text-item").text();b.html(d)});a.on("click",function(d){d.stopPropagation();$(this).parents("li").remove()})}var modelCounter=0;function deepCopy(b,d){var d=d||{};for(var a in b){if(!b.hasOwnProperty(a)){continue}if(typeof b[a]==="object"){d[a]=(b[a].constructor===Array)?[]:{};deepCopy(b[a],d[a])}else{d[a]=b[a]}}return d}function toggleModel(b){var c=$("#"+b);c.on("click",function(){$(".dms-prop-wrap").hide();$("."+b+"_box").show()})}function play(d,c){var e="";jsPlumb.ready(function(){var j=d;var m=c;var h={lineWidth:2,strokeStyle:"#61B7CF",joinstyle:"round",outlineColor:"white",outlineWidth:0};var a={lineWidth:3,strokeStyle:"#216477",outlineColor:"white",outlineWidth:0};var p={endpoint:["Dot",{radius:8}],connectorStyle:h,connectorHoverStyle:a,paintStyle:{strokeStyle:"#1e8151",fillStyle:"transparent",radius:4,lineWidth:2},auchor:"AutoDefault",isSource:true,connector:["Bezier",{stub:[40,60],gap:10,cornerRadius:5,alwaysRespectStubs:true}],isTarget:false,maxConnections:-1,connectorOverlays:[["Arrow",{width:10,length:10,location:1}],["Label",{location:0.4,id:"label"}]]};var n={endpoint:["Dot",{radius:5}],connectorStyle:h,connectorHoverStyle:a,paintStyle:{fillStyle:"#1e8151"},isSource:false,connector:["Bezier",{stub:[40,60],gap:10,cornerRadius:5,alwaysRespectStubs:true}],isTarget:true,maxConnections:-1,connectorOverlays:[["Arrow",{width:10,length:10,location:1}]]};$("#leftMenu dd").draggable({helper:"clone",scope:"ss"});var f=0;$("#container").droppable({scope:"ss",drop:function(i,t){f++;var w="model_"+modelCounter++;var v=parseInt(t.offset.left-$(this).offset().left);var u=parseInt(t.offset.top-$(this).offset().top);var s=$('<div class="item model pane-node-content" data-sign="'+f+'" data-id="'+w+'" data-index="'+$(t.draggable[0]).attr("data-index")+'"  id="'+w+'"><span class="icon icon-doc"></span><span class="name">'+$(t.helper).html()+'</span><span  class="status icon-success"></span></div>');s.css({left:v,top:u,position:"absolute",margin:0});$(this).append(s);jsPlumb.addEndpoint(s,{anchors:"BottomCenter"},p);jsPlumb.addEndpoint(s,{anchors:"TopCenter"},n);jsPlumb.draggable(s,{containment:"parent"});$(s).draggable({containment:"parent"});workArea("ui-workarea-menu-layer");toggleModel("model_0");toggleModel("model_1");toggleModel("model_2");toggleModel("model_3");toggleModel("model_4");toggleModel("model_5");toggleModel("model_6")}});function o(s){var i=$(s);if(confirm("确定删除该模型？")){jsPlumb.remove(i)}}jsPlumb.bind("click",function(s,i){if(confirm("确定删除？")){jsPlumb.detach(s)}});jsPlumb.bind("connection",function(s,i){q(s.connection);alert(4);if(s.connection.sourceId==s.connection.targetId){jsPlumb.detach(s);alert("不能连接自己！")}});jsPlumb.bind("connection",function(i){i.connection.getOverlay("label").setLabel(i.connection.id)});sessionStorage.setItem("flowsheet",JSON.stringify({connects:j,mainArr:m}));if(!sessionStorage.getItem("flowsheet")){}else{f++;var b="model_"+modelCounter++;var g=JSON.parse(sessionStorage.getItem("flowsheet"));var r="";for(var k=0;k<g.mainArr.length;k++){if(f<g.mainArr[k].sign){f=g.mainArr[k].sign}r+='<div class="model pane-node-content item"   data-sign="'+g.mainArr[k].sign+'" data-id="'+g.mainArr[k].sid+'" data-index="'+g.mainArr[k].index+'" id="'+g.mainArr[k].id+'" style="left:'+g.mainArr[k].offset.left+"px;top:"+g.mainArr[k].offset.top+'px;position:absolute;margin:0"  ><span class="icon icon-doc"></span><span class="name">'+g.mainArr[k].text+'</span><span  class="status icon-success"></span></div>'}$("#container").append(r);$("#container .item").each(function(){jsPlumb.addEndpoint(this,{anchors:"BottomCenter"},deepCopy(p,{uuid:$(this).attr("data-sign")+"origin"}));jsPlumb.addEndpoint(this,{anchors:"TopCenter"},deepCopy(n,{uuid:$(this).attr("data-sign")+"destination"}));jsPlumb.draggable(this,{containment:"parent"});$(this).draggable({containment:"parent"})});for(var k=0;k<g.connects.length;k++){jsPlumb.connect({uuids:[g.connects[k].originSign+"origin",g.connects[k].destinationSign+"destination"]})}workArea("ui-workarea-menu-layer");linePlay();toggleModel("model_0");toggleModel("model_1");toggleModel("model_2");toggleModel("model_3");toggleModel("model_4");toggleModel("model_5");toggleModel("model_6")}function q(t){var u;$("#select_sourceList").empty();$("#select_targetList").empty();var i=$("#"+t.sourceId).attr("id");var s=$("#"+t.targetId).attr("id");$("#submit_label").unbind("click");$("#submit_label").on("click",function(){l(t)});$("#"+s).siblings("svg._jsPlumb_connector").last().attr("id",i+"_"+s)}function l(i){i.getOverlay("label").setLabel($("#select_sourceList").val()+" "+$("#select_comparison").val()+" "+$("#select_targetList").val());if($("#twoWay").val()=="true"){i.setParameter("twoWay",true)}else{i.setParameter("twoWay",false);i.hideOverlay("arrow_backwards")}}})}function save(){var b=[];var a=[];$.each(jsPlumb.getAllConnections(),function(c,d){b.push({ConnectionId:d.id,start:$(d.source).attr("data-index"),end:$(d.target).attr("data-index"),originSign:$(d.source).attr("data-sign"),destinationSign:$(d.target).attr("data-sign")})});$("#container .item").each(function(){a.push({offset:$(this).position(),text:$(this).text(),index:$(this).attr("data-index"),sign:$(this).attr("data-sign"),sid:$(this).attr("data-id"),id:$(this).attr("id")})});sessionStorage.setItem("flowsheet",JSON.stringify({connects:b,mainArr:a}))}function val(){var a=[];var b=$(".right_wrap .table-body tr:visible .abc");b.each(function(){a.push($(this).text())})}function linePlay(){$("#model_0_model_1").attr("class","_jsPlumb_connector active")}function reportChart(d,c){var e=echarts.init(document.getElementById("charts-report"));var g=d;var f=c;option={title:{text:"Gain",subtext:"Gain值"},tooltip:{trigger:"axis"},toolbox:{show:true,feature:{dataView:{readOnly:false},magicType:{type:["line","bar"]},saveAsImage:{}}},xAxis:{type:"category",boundaryGap:false,data:g},yAxis:{type:"value",axisLabel:{formatter:"{value} °C"}},dataZoom:[{type:"slider",start:0,end:100}],series:[{name:"最高气温",type:"line",data:f,markPoint:{data:[{type:"max",name:"最大值"}]}}]};e.setOption(option)}function radio(c){var b=$("."+c+" input.radioBox");var g=$("."+c+" .right_wrap .table-body tbody td").eq(1);var f=$("."+c+" .right_wrap .table-body tbody td").eq(2);var e=$("."+c+" .right_wrap .btn-delete");var d="";b.on("click",function(){$("."+c+" .right_wrap .table-body tbody tr").show();var h=$(this).siblings("span.radioBox").text();var a=$(this).parents("ul.zero-accordion").find(".zero-accordion-title span").text();g.text(h);f.text(a)});e.on("click",function(){$(this).parents(".selected-list").find(".table-body tr").hide();$("."+c+" input.radioBox").prop("checked",false)})}function fieldSet(b){var c=$("."+b+" .btn-add");var g=$("."+b+" .dms-prop-item");var f=$("."+b+" .dms-prop-input");var e=$("."+b+" .btn-delete");var d="";d+='<div class="dms-prop-input"> <div class="dms-prop-col-join"><div class="select-group"><div class="left-select"><input value=""  class="form-control" type="text"></div><div class="middle-sign">=</div><div class="right-select"><input value=""  class="form-control" type="text"></div></div><div class="btn-delete icon-close-o" onclick="btndel(this)"></div></div></div>';c.on("click",function(){e.show();g.append(d);console.log(f.length)});e.on("click",function(){console.log(f.length)})}function toggleTest(b){var c=$(".pai-btn-test"),d=$("."+b)[0].style,e=$(".copy-test-btn");c.on("contextmenu",function(a){var a=a||window.event;d.display="block";d.top=a.clientY+"px";d.left=a.clientX+"px";$(".new-template-btn,.new-et-btn").on("click",function(f){f.stopPropagation();$(".pai-home").animate({bottom:0},0);d.display="none"});return false});$(".new-et-btn").on("click",function(a){a.stopPropagation();$(".pai-home").animate({bottom:0},0);d.display="none"});$("body").on("click",function(){d.display="none"})}$(function(){$(".pai-et-box").on("click",function(){var b=$(this).index();switch(b){case 0:var a=[{ConnectionId:"con_12",start:"1",end:"2",originSign:"2",destinationSign:"3"},{ConnectionId:"con_12",start:"1",end:"2",originSign:"2",destinationSign:"3"}];var e=[{offset:{top:67,left:216},text:"\n\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\tTensorflow图片分类1\n\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t",index:"1",sign:"2",sid:"model_1",id:"model_1"},{offset:{top:205,left:344},text:"\n\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\tTensorflow图片分类2\n\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t",index:"2",sign:"3",sid:"model_2",id:"model_2"}];test(a,e);break;case 1:var d=[{ConnectionId:"con_12",start:"1",end:"3",originSign:"1",destinationSign:"2"}];var c=[{offset:{top:60,left:122},text:"\n\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\tTensorflow图片分类1\n\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t",index:"1",sign:"1",sid:"model_0",id:"model_0"},{offset:{top:59,left:434},text:"\n\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\tTensorflow图片分类3\n\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t",index:"3",sign:"2",sid:"model_1",id:"model_1"}];test(d,c);break}})});function test(d,c){$("#container").html("");sessionStorage.clear();play(d,c)};