/*!
 * jQuery Menu
 *
 * Written by sizeof(cat) <sizeofcat AT riseup DOT net>
 * Licensed under the MIT license
 * Version 2.0.0
 */
(function(d){var b={popup_div:"catMenu",separator:"separator",hover:"hover",disabled:"disabled"},e={menu:null,mouse_button:"right",is_menu:true,min_width:120,max_width:0,delay:500,keyboard:true,hover_intent:true,on_select:function(h){},on_load:function(){},on_show:function(){},on_hide:function(){}},c=[],a={init:function(h){h=d.extend({},e,h);if(!h.menu){return false}var i;if((typeof(h.menu)==="object")&&(h.menu.constructor.toString().match(/array/i)!==null||h.menu.length)){i=d("<div/>").append(f(h.menu));d("body").append(i);i.data("catMenuDynamic",true)}else{i=d(document.getElementById(h.menu));i.data("catMenuDynamic",false);i.data("catMenuOriginal",i.clone())}return this.each(function(){var k=d(this);var j;if(!k.data("catMenu")){j="catMenuContext-"+(new Date().getTime());k.data("catMenuEventNamespace",j).data("catMenuOptions",h).data("catMenu",i).data("catMenuEnable",true);i.data("is_menu",h.is_menu);if(!i.data("catMenuOwners")){i.data("catMenuOwners",[])}i.data("catMenuOwners").push(k);c.push(i);if(h.is_menu){a.refresh.call(k)}else{i.hide();i.css({position:"absolute","z-index":99999})}k.bind((((h.mouse_button==="right")?"contextmenu":"click")+"."+j),function(l){if(!k.data("catMenuEnable")){return true}a.show.apply(k,[l.pageX,l.pageY,h.show_animation]);if(h.is_menu&&h.keyboard){d(window).bind("keydown."+j,function(n){var m;switch(event.keyCode){case 27:d(document).trigger("click."+j);break;case 40:if(i.find("li."+b.hover).length===0){i.find("li:not(.disabled):first").addClass(b.hover)}else{m=i.find("li."+b.hover+":last");m.parent().find("li."+b.hover).removeClass(b.hover).nextAll("li:not(.disabled)").eq(0).addClass(b.hover);if(m.parent().find("li."+b.hover).length===0){m.parent().find("li:not(.disabled):first").addClass(b.hover)}}return false;case 38:if(i.find("li."+b.hover).length===0){i.find("li:not(.disabled):first").nextAll().eq(-1).addClass(b.hover)}else{m=i.find("li."+b.hover+":last");m.parent().find("li."+b.hover).removeClass(b.hover).prevAll("li:not(.disabled)").eq(0).addClass(b.hover);if(m.parent().find("li."+b.hover).length===0){m.parent().find("li:first").nextAll().eq(-1).addClass(b.hover)}}return false;case 39:if(i.find("li."+b.hover+" ul").length>0){i.find("li."+b.hover+":last").find("ul:first").show().offset(g({top:i.find("li."+b.hover+":last").offset().top},i.find("li."+b.hover+":last").find("ul:first")));i.find("li."+b.hover+":last ul:first li:not(.disabled):first").addClass(b.hover)}return false;case 37:if(!i.find("li."+b.hover+":last").parent().parent().hasClass(b.popup_div)){i.find("li."+b.hover+":last").removeClass(b.hover).parent().hide()}return false}return true})}else{if(h.keyboard){d(window).bind("keydown."+j,function(m){if(event.keyCode===27){d(document).trigger("click."+j)}})}}d("li",i).each(function(){d(this).click(function(){if(!d(this).hasClass(b.disabled)){h.on_select.call(this,{id:d(this).attr("id"),action:d("a:first",this).attr("href").substr(1)})}})});d(document).bind("click."+j,function(m){d(window).unbind("keydown."+j);d(document).unbind("click."+j);d("li",i).unbind("click");a.hide.call()});h.on_show.call(this);return false})}h.on_load.call(this)})},refresh:function(h){var i;return this.each(function(){var m=d(this);var k=m.data("catMenu");var l;var j;if(m.data("catMenu").data("is_menu")){i=d.extend(m.data("catMenuOptions"),h);if(i.hover_intent&&!d.fn.hoverIntent){i.hover_intent=false}k.removeClass(b.popup_div);d("li",k).removeClass(b.hover);d("span",k).remove();k.addClass(b.popup_div);j=d("<div/>").addClass(b.popup_div).appendTo("body");d("ul",k).each(function(){j.html("");l=0;j.html(d(this).html());l=j.width()+16;if(l<i.min_width){l=i.min_width}if(l>i.max_width&&i.max_width>0){l=i.max_width}d(this).width(l);d(this).children("li").children("ul").css("left",l)});j.remove();d("li:has(ul)",k).each(function(){if(!d(this).hasClass(b.disabled)){d("a:first",this).append(d("<span/>"));if(i.hover_intent){d(this).hoverIntent({over:function(){d("ul:first",this).show().offset(g({top:d(this).offset().top},d("ul:first",this)))},out:function(){d("ul:first",this).hide()},timeout:i.delay})}else{d(this).hover(function(){d("ul:first",this).show().offset(g({top:d(this).offset().top},d(this).find("ul:first")))},function(){d("ul:first",this).hide()})}}});d("li",k).each(function(){d(this).click(function(){if(d("ul",this).length<1){d("li",k).unbind("click");k.hide()}return false});d(this).hover(function(){d(this).parent().find("li."+b.hover).removeClass(b.hover);d(this).addClass(b.hover)},function(){d(this).removeClass(b.hover)})})}})},restore:function(){return this.each(function(){var i=d(this),h=i.data("catMenu");i.unbind("."+i.data("catMenuEventNamespace"));d(window).unbind("keydown."+i.data("catMenuEventNamespace"));d(document).unbind("click."+i.data("catMenuEventNamespace"));d.each(h.data("catMenuOwners"),function(j){if(i[0]===this){h.data("catMenuOwners").splice(j,1)}});if(h.data("catMenuOwners").length<1){d.each(c,function(j){if(h[0]===this){c.splice(j,1)}});if(h.data("catMenuDynamic")){h.remove()}else{h.removeClass(b.popup_div);h.replaceWith(h.data("catMenuOriginal"))}}i.removeData("catMenuEventNamespace");i.removeData("catMenu");i.removeData("catMenuOptions");i.removeData("catMenuEnable")})},show:function(h,j){if(!h||!j){return false}var i=d(this).first().data("catMenu");a.hide.apply(this);i.show();i.data("catMenu",d(this));i.offset(g({top:j,left:h},i,true));return this},hide:function(){d.each(c,function(){d("."+b.hover,this).removeClass(b.hover);d("ul:first ul",this).hide();if(d(this).data("catMenu")){d(this).data("catMenu").data("catMenuOptions").on_hide.call(d(this).data("catMenu"));d(this).removeData("catMenu")}d(this).hide()});return this},disable:function(i){if(i){var h=d(this).data("catMenu");if(i.charAt(0)==="#"){d("li"+i.replace(/ /g,"_"),h).addClass(b.disabled)}else{d('a[href="'+i+'"]',h).parent().addClass(b.disabled)}}else{d(this).data("catMenuEnable",false)}return this},enable:function(i){if(i){var h=d(this).data("catMenu");if(i.charAt(0)==="#"){d("li"+i.replace(/ /g,"_"),h).removeClass(b.disabled)}else{d('a[href="'+i+'"]',h).parent().removeClass(b.disabled)}}else{d(this).data("catMenuEnable",true);d("li",this).each(function(){d(this).removeClass(b.disabled)})}return this}},g=function(h,j,i){if(h.top){if((h.top+j.height()-d(window).scrollTop())>d(window).height()){if(i){h.top=h.top-j.height()}else{h.top=d(window).height()+d(window).scrollTop()-j.height()}}if(h.top<d(window).scrollTop()){h.top=d(window).scrollTop()}}if(h.left){if((h.left+j.width()-d(window).scrollLeft()>d(window).width())){h.left=d(window).width()-j.width()+d(window).scrollLeft()}if(h.left<d(window).scrollLeft()){h.left=d(window).scrollLeft()}}return h},f=function(j){var i=d("<ul/>"),l,k,h;if(j){for(l in j){k=j[l];h=d("<li/>").attr("id",k.id.replace(/ /g,"_")).append(d("<a/>").attr("href",k.action?("#"+k.action):"#").text(k.text));if(k.image){h.prepend(d("<img/>").attr("src",k.image))}if(k.separator){h.addClass(b.separator)}i.append(h);if(k.children){h.append(f(k.children))}}}return i};d.fn.catMenu=function(h){if(a[h]){return a[h].apply(this,Array.prototype.slice.call(arguments,1))}else{if(typeof h==="object"||!h){return a.init.apply(this,arguments)}else{return this}}}})(jQuery);